---
title: "Wages and Cost"
author: "ruby"
date: "2024-11-04"
output: pdf_document
---

```{r}
library(data.table)
library(ggplot2)
library(patchwork)
```

```{r}
ppermile <- fread("finalppm.csv")
Wages <- fread("Wages.csv")
HoursWorked <- fread("table32020revised/HoursWorkedbyRegion.csv")
HourlyPay <- fread("table32020revised/HourlyPaybyRegion.csv")
AnnualPay <- fread("table32020revised/AnnualPaybyRegion.csv")
WeeklyPay <- fread("table32020revised/WeeklyPaybyRegion.csv")
EarningsandHours <- fread("EarningsandHours.csv")
```

```{r}
ggplot() + geom_line(EarningsandHours, mapping = aes(x= Date, y=`Weekly earnings`, colour = "red")) + geom_line(EarningsandHours,  mapping = aes(x = Date, y = `Average weekly hours of work:All workers`))+ theme_classic()
```


```{r}
HoursWorked[, c("10 percentile", "20 percentile", "25 percentile", "30 percentile", "40 percentile", "50 percentile", "60 percentile", "70 percentile", "80 percentile", "90 percentile"):=NULL]
AnnualPay[, c("10 percentile", "20 percentile", "25 percentile", "30 percentile", "40 percentile", "50 percentile", "60 percentile", "70 percentile", "80 percentile", "90 percentile"):=NULL]
WeeklyPay[, c("10 percentile", "20 percentile", "25 percentile", "30 percentile", "40 percentile", "50 percentile", "60 percentile", "70 percentile", "80 percentile", "90 percentile"):=NULL]
HourlyPay[, c("10 percentile", "20 percentile", "25 percentile", "30 percentile", "40 percentile", "50 percentile", "60 percentile", "70 percentile", "80 percentile", "90 percentile"):=NULL]
ppermile[, c("dayofquery", "Car", "MY", "Category", "UniqueID", "DirectDebitComparison", "DirectDebitComparisonNight"):=NULL]
ppermile <- ppermile[, yearmonth := lubridate::round_date(date, "months")]
EarningsandHours <- EarningsandHours[95:390]
EarningsandHours[, c("percent changes: single month", "percent changes: 3 month average", "EndDate") :=NULL]
```

```{r}
ggplot(HourlyPay, aes(x= Date, y= Median, colour = Description)) + geom_line() + theme_classic()+ ylab("Median hourly pay (£)")
ggplot(HourlyPay, aes(x= Date, y= Mean, colour = Description)) + geom_line() + theme_classic() + ylab("Mean hourly pay (£)")

ggplot(AnnualPay, aes(x= Date, y= Median, colour = Description)) + geom_line() + theme_classic()+ ylab("Median annual pay (£)")
ggplot(AnnualPay, aes(x= Date, y= Mean, colour = Description)) + geom_line() + theme_classic() + ylab("Mean annual pay (£)")

ggplot(WeeklyPay, aes(x= Date, y= Median, colour = Description)) + geom_line() + theme_classic()+ ylab("Median weekly pay (£)")
ggplot(WeeklyPay, aes(x= Date, y= Mean, colour = Description)) + geom_line() + theme_classic() + ylab("Mean weekly pay (£)")
```


```{r}
CostofDriving <- merge(ppermile, EarningsandHours, by.x = "yearmonth", by.y="Date", all = TRUE)
CostofDriving <- CostofDriving[yearmonth >= "2020-12-30"]

CostofDriving <- CostofDriving[, WagesinPence := `Weekly earnings` * 100]
CostofDriving <- CostofDriving[, costwage := (WagesinPence / ppm)/ `Average weekly hours of work:All workers` ]
```

ppm : how much you spend for one mile
average earnings per week in pence

```{r}
ggplot(ppermile, aes(x= date, y = ppm, colour = fuel)) + geom_line() + theme_classic()+ ylim(0, NA) + theme(legend.position = "bottom") + ylab("Pence per mile")

ggplot(CostofDriving, aes(x = date, y= costwage, colour = fuel)) + geom_line() + theme_classic()+ ylim(0, NA)+ theme(legend.position = "bottom") + ylab("Hours worked to drive x miles")
```
ppm 
ppm/ weekly wage 


Petrol: Usually averages around 36 MPG
Diesel: Usually averages around 43 MPG
Hybrid: Averages around 59 MPG
Full-electric: Averages around 159 MPGe

```{r}
ppermile %>%
  ggplot( aes(x=date, y=ppm, group=fuel, color=fuel)) +
    geom_line() +
    scale_color_viridis(discrete = TRUE) +
    ggtitle("xyz") +
    theme_classic()

ppermile %>%
  mutate( highlight=ifelse(fuel=="Petrol", "Petrol", c("mean rapid charger", "Direct debit: Average variable night unit price, United Kingdom"))) %>%
  ggplot( aes(x=date, y=ppm, group=fuel, color=highlight, size=highlight)) +
    geom_line() +
    scale_color_manual(values = c("#69b3a2", "lightgrey", "lightgrey")) +
    scale_size_manual(values=c(1.5,0.2, 0.2)) + ggtitle("xyz2") +
    theme_classic()
```


```{r}
data %>%
  ggplot( aes(x=year, y=n, group=name, fill=name)) +
    geom_area() +
    scale_fill_viridis(discrete = TRUE) +
    theme(legend.position="none") +
    ggtitle("Popularity of American names in the previous 30 years") +
    theme_ipsum() +
    theme(
      legend.position="none",
      panel.spacing = unit(0.1, "lines"),
      strip.text.x = element_text(size = 8),
      plot.title = element_text(size=14)
    ) +
    facet_wrap(~name)
    
    tmp <- data %>%
  mutate(name2=name)

tmp %>%
  ggplot( aes(x=year, y=n)) +
    geom_line( data=tmp %>% dplyr::select(-name), aes(group=name2), color="grey", size=0.5, alpha=0.5) +
    geom_line( aes(color=name), color="#69b3a2", size=1.2 )+
    scale_color_viridis(discrete = TRUE) +
    theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=14),
      panel.grid = element_blank()
    ) +
    ggtitle("A spaghetti chart of baby names popularity") +
    facet_wrap(~name)

```



# Load dataset from github
data <- babynames %>%
  filter(name %in% c("Mary","Emma", "Ida", "Ashley", "Amanda", "Jessica",    "Patricia", "Linda", "Deborah",   "Dorothy", "Betty", "Helen")) %>%
  filter(sex=="F")

# Plot
data %>%
  ggplot( aes(x=year, y=n, group=name, color=name)) +
    geom_line() +
    scale_color_viridis(discrete = TRUE) +
    theme(
      legend.position="none",
      plot.title = element_text(size=14)
    ) +
    ggtitle("A spaghetti chart of baby names popularity") +
    theme_ipsum()

data %>%
  mutate( highlight=ifelse(name=="Amanda", "Amanda", "Other")) %>%
  ggplot( aes(x=year, y=n, group=name, color=highlight, size=highlight)) +
    geom_line() +
    scale_color_manual(values = c("#69b3a2", "lightgrey")) +
    scale_size_manual(values=c(1.5,0.2)) +
    theme(legend.position="none") +
    ggtitle("Popularity of American names in the previous 30 years") +
    theme_ipsum() +
    geom_label( x=1990, y=55000, label="Amanda reached 3550\nbabies in 1970", size=4, color="#69b3a2") +
    theme(
      legend.position="none",
      plot.title = element_text(size=14)
)

data %>%
  ggplot( aes(x=year, y=n, group=name, fill=name)) +
    geom_area() +
    scale_fill_viridis(discrete = TRUE) +
    theme(legend.position="none") +
    ggtitle("Popularity of American names in the previous 30 years") +
    theme_ipsum() +
    theme(
      legend.position="none",
      panel.spacing = unit(0.1, "lines"),
      strip.text.x = element_text(size = 8),
      plot.title = element_text(size=14)
    ) +
    facet_wrap(~name)
    
    tmp <- data %>%
  mutate(name2=name)

tmp %>%
  ggplot( aes(x=year, y=n)) +
    geom_line( data=tmp %>% dplyr::select(-name), aes(group=name2), color="grey", size=0.5, alpha=0.5) +
    geom_line( aes(color=name), color="#69b3a2", size=1.2 )+
    scale_color_viridis(discrete = TRUE) +
    theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=14),
      panel.grid = element_blank()
    ) +
    ggtitle("A spaghetti chart of baby names popularity") +
    facet_wrap(~name)
